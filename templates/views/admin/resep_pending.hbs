<section class="bagian">
  <div class="kartu">
    <h2 class="kartu-judul">Resep Pending</h2>
    {{#if error}}<div class="peringatan">{{error}}</div>{{/if}}
    <table class="tabel">
      <thead><tr><th>Nama</th><th>Pengirim</th><th>Nama</th><th></th></tr></thead>
      <tbody>
        {{#each resep}}
          <tr>
            <td>{{this.namaResep}}</td>
            <td>{{this.submittedBy}}</td>
            <td>{{this.kategori}}</td>
            <td>
              <button class="tombol-kecil" data-approve-id="{{this._id}}">Setujui</button>
              <button class="tombol-kecil tombol-bahaya" data-reject-id="{{this._id}}">Tolak</button>
            </td>
          </tr>
        {{/each}}
      </tbody>
    </table>
  </div>
</section>

<script>
// simple delegated handler for approve/reject
document.addEventListener('click', async (e)=>{
  const btn = e.target;
  if (btn.dataset.approveId) {
    if (!confirm('Setujui resep ini?')) return;
    const id = btn.dataset.approveId;
    const resp = await fetch('/admin/resep/'+id+'/approve', { method: 'POST', headers:{'Content-Type':'application/json'} });
    const data = await resp.json();
    if (data && data.sukses) { alert('Resep disetujui'); location.reload(); } else alert('Gagal: '+(data.pesan||'')); 
  }
  if (btn.dataset.rejectId) {
    const note = prompt('Alasan penolakan (opsional)');
    if (note === null) return;
    const id = btn.dataset.rejectId;
    const resp = await fetch('/admin/resep/'+id+'/reject', { method: 'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({ moderationNote: note }) });
    const data = await resp.json();
    if (data && data.sukses) { alert('Resep ditolak'); location.reload(); } else alert('Gagal: '+(data.pesan||''));
  }
});
</script>
<script src="/js/admin.js"></script>